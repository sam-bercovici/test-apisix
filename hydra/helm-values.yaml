image:
  tag: v25.4.0

hydra:
  dev: true  # For local development only
  automigration:
    enabled: true
    type: job
  config:
    dsn: postgres://hydra:hydra@hydra-postgres-rw.hydra.svc.cluster.local:5432/hydra?sslmode=disable
    secrets:
      system:
        - "this-is-a-32-char-secret-for-dev"
    urls:
      self:
        issuer: http://hydra.local/auth
      login: http://localhost:3000/login      # Unused for M2M
      consent: http://localhost:3000/consent  # Unused for M2M
    strategies:
      access_token: jwt
    ttl:
      access_token: 1h
      refresh_token: 0s
    oauth2:
      expose_internal_errors: false
      client_credentials:
        default_grant_allowed_scope: true
      token_hook:
        url: http://127.0.0.1:8080/token-hook  # Sidecar container (localhost)
    log:
      level: info
      format: json

deployment:
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi
  # Hydra sidecar - token hook + client sync + bulk sync
  extraContainers: |
    - name: hydra-sidecar
      image: hydra-sidecar:latest
      imagePullPolicy: IfNotPresent
      ports:
        - containerPort: 8080
          name: http
      env:
        - name: PORT
          value: "8080"
        - name: HYDRA_ADMIN_URL
          value: "http://localhost:4445"
        - name: DATABASE_URL
          value: "postgres://hydra:hydra@hydra-postgres-rw.hydra.svc.cluster.local:5432/hydra?sslmode=disable"
        - name: HASHER_ALGORITHM
          value: "pbkdf2"
      resources:
        requests:
          cpu: 50m
          memory: 64Mi
        limits:
          cpu: 200m
          memory: 128Mi
      readinessProbe:
        httpGet:
          path: /ready
          port: 8080
        initialDelaySeconds: 5
        periodSeconds: 10
      livenessProbe:
        httpGet:
          path: /health
          port: 8080
        initialDelaySeconds: 10
        periodSeconds: 30

service:
  public:
    type: ClusterIP
    port: 4444
  admin:
    type: ClusterIP
    port: 4445

maester:
  enabled: false  # Disable CRD-based client management
