basePath: /
definitions:
  main.ClientResult:
    properties:
      client_id:
        example: acme-service-1
        type: string
      error:
        type: string
      status:
        description: '"created", "updated", "deleted", "failed"'
        example: created
        type: string
    type: object
  main.EnhancedClientResponse:
    properties:
      client_credentials_grant_access_token_lifespan:
        description: Access token lifespan for client_credentials grant
        example: 1h
        type: string
      client_id:
        description: OAuth2 client ID
        example: acme-service-1
        type: string
      client_name:
        description: Human-readable client name
        example: Acme Service 1
        type: string
      client_secret:
        description: Client secret (only returned on creation)
        example: secret123
        type: string
      client_secret_expires_at:
        description: Unix timestamp when client secret expires (0 = never)
        example: 1735689600
        type: integer
      client_secret_hash:
        example: $pbkdf2-sha512$...
        type: string
      metadata:
        additionalProperties: true
        description: Client metadata
        type: object
    type: object
  main.HydraClientResponse:
    properties:
      client_credentials_grant_access_token_lifespan:
        description: Access token lifespan for client_credentials grant
        example: 1h
        type: string
      client_id:
        description: OAuth2 client ID
        example: acme-service-1
        type: string
      client_name:
        description: Human-readable client name
        example: Acme Service 1
        type: string
      client_secret:
        description: Client secret (only returned on creation)
        example: secret123
        type: string
      client_secret_expires_at:
        description: Unix timestamp when client secret expires (0 = never)
        example: 1735689600
        type: integer
      metadata:
        additionalProperties: true
        description: Client metadata
        type: object
    type: object
  main.RotateClientRequest:
    properties:
      client_secret_expires_at:
        description: Unix timestamp when the new client secret expires, 0 means never
          (optional)
        example: 1735689600
        type: integer
    type: object
  main.SyncClient:
    properties:
      audience:
        description: Allowed audiences (optional)
        items:
          type: string
        type: array
      client_credentials_grant_access_token_lifespan:
        description: Access token lifespan for client_credentials grant, e.g. "1h",
          "30m" (optional)
        example: 1h
        type: string
      client_id:
        description: Client ID (required)
        example: acme-service-1
        type: string
      client_name:
        description: Human-readable client name (optional)
        example: Acme Service 1
        type: string
      client_secret:
        description: Pre-hashed client secret (required)
        example: $pbkdf2-sha512$...
        type: string
      client_secret_expires_at:
        description: Unix timestamp when client secret expires, 0 means never (optional)
        example: 1735689600
        type: integer
      grant_types:
        description: OAuth2 grant types (optional, defaults to ["client_credentials"])
        example:
        - client_credentials
        items:
          type: string
        type: array
      metadata:
        additionalProperties: true
        description: Client metadata for JWT claims (optional)
        type: object
      redirect_uris:
        description: Redirect URIs (optional)
        items:
          type: string
        type: array
      response_types:
        description: OAuth2 response types (optional)
        example:
        - token
        items:
          type: string
        type: array
      scope:
        description: Space-separated list of scopes (optional)
        example: read write
        type: string
      token_endpoint_auth_method:
        description: Token endpoint auth method (optional, defaults to "client_secret_basic")
        example: client_secret_basic
        type: string
    type: object
  main.SyncClientsRequest:
    properties:
      clients:
        items:
          $ref: '#/definitions/main.SyncClient'
        type: array
    type: object
  main.SyncResult:
    properties:
      created_count:
        example: 5
        type: integer
      deleted_count:
        example: 1
        type: integer
      failed_count:
        example: 0
        type: integer
      results:
        items:
          $ref: '#/definitions/main.ClientResult'
        type: array
      updated_count:
        example: 3
        type: integer
    type: object
  main.TokenHookErrorResponse:
    properties:
      error:
        type: string
      error_description:
        type: string
    type: object
  main.TokenHookRequest:
    properties:
      request:
        properties:
          client_id:
            example: acme-service-1
            type: string
          granted_scopes:
            example:
            - read
            - write
            items:
              type: string
            type: array
        type: object
      session:
        properties:
          client_id:
            example: acme-service-1
            type: string
        type: object
    type: object
  main.TokenHookResponse:
    properties:
      session:
        properties:
          access_token:
            additionalProperties: true
            type: object
        type: object
    type: object
host: localhost:8080
info:
  contact:
    name: API Support
  description: Sidecar service for Ory Hydra that provides token hook functionality,
    client creation with secret hashing, and bulk client sync.
  license:
    name: Apache 2.0
    url: http://www.apache.org/licenses/LICENSE-2.0.html
  title: Hydra Sidecar API
  version: "1.0"
paths:
  /admin/clients:
    post:
      consumes:
      - application/json
      description: Proxies client creation to Hydra Admin API and returns the response
        enriched with client_secret_hash
      parameters:
      - description: Client configuration
        in: body
        name: client
        required: true
        schema:
          $ref: '#/definitions/main.HydraClientResponse'
      produces:
      - application/json
      responses:
        "200":
          description: Client created with secret hash
          schema:
            $ref: '#/definitions/main.EnhancedClientResponse'
        "201":
          description: Client created with secret hash
          schema:
            $ref: '#/definitions/main.EnhancedClientResponse'
        "400":
          description: Bad request
          schema:
            type: string
        "405":
          description: Method not allowed
          schema:
            type: string
        "502":
          description: Failed to create client in Hydra
          schema:
            type: string
      summary: Create OAuth2 client
      tags:
      - clients
  /admin/clients/{client_id}:
    delete:
      description: Deletes a client from Hydra by client_id
      parameters:
      - description: Client ID to delete
        in: path
        name: client_id
        required: true
        type: string
      responses:
        "204":
          description: Client deleted
        "400":
          description: Bad request - missing client_id
          schema:
            type: string
        "404":
          description: Client not found
          schema:
            type: string
        "502":
          description: Failed to delete client in Hydra
          schema:
            type: string
      summary: Delete OAuth2 client
      tags:
      - clients
    get:
      description: Retrieves a client from Hydra by client_id
      parameters:
      - description: Client ID
        in: path
        name: client_id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Client details
          schema:
            $ref: '#/definitions/main.HydraClientResponse'
        "400":
          description: Bad request - missing client_id
          schema:
            type: string
        "404":
          description: Client not found
          schema:
            type: string
        "502":
          description: Failed to get client from Hydra
          schema:
            type: string
      summary: Get OAuth2 client
      tags:
      - clients
  /admin/clients/rotate/{client_id}:
    post:
      consumes:
      - application/json
      description: Rotates the client secret and returns the new secret along with
        its hash from the database. Optionally accepts client_secret_expires_at to
        set expiration for the new secret.
      parameters:
      - description: Client ID
        in: path
        name: client_id
        required: true
        type: string
      - description: Optional expiration settings
        in: body
        name: request
        schema:
          $ref: '#/definitions/main.RotateClientRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Client with new secret and hash
          schema:
            $ref: '#/definitions/main.EnhancedClientResponse'
        "400":
          description: Bad request - missing client_id
          schema:
            type: string
        "404":
          description: Client not found
          schema:
            type: string
        "405":
          description: Method not allowed
          schema:
            type: string
        "502":
          description: Failed to rotate client secret in Hydra
          schema:
            type: string
      summary: Rotate client secret
      tags:
      - clients
  /health:
    get:
      description: Returns OK if the server is running (liveness probe)
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
      summary: Health check
      tags:
      - health
  /ready:
    get:
      description: Returns OK if the database connection is healthy (readiness probe)
      produces:
      - text/plain
      responses:
        "200":
          description: OK
          schema:
            type: string
        "503":
          description: Database not ready
          schema:
            type: string
      summary: Readiness check
      tags:
      - health
  /sync/clients:
    post:
      consumes:
      - application/json
      description: Performs full reconciliation of clients - creates new, updates
        existing, deletes removed. Expects pre-hashed secrets.
      parameters:
      - description: List of clients to sync
        in: body
        name: clients
        required: true
        schema:
          $ref: '#/definitions/main.SyncClientsRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Sync completed
          schema:
            $ref: '#/definitions/main.SyncResult'
        "400":
          description: Bad request - invalid JSON or hash format
          schema:
            type: string
        "405":
          description: Method not allowed
          schema:
            type: string
        "500":
          description: Internal error during sync
          schema:
            type: string
      summary: Bulk sync OAuth2 clients
      tags:
      - clients
  /token-hook:
    post:
      consumes:
      - application/json
      description: Called by Hydra during token issuance to inject client metadata
        into JWT claims. Rejects expired clients.
      parameters:
      - description: Token hook request from Hydra
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/main.TokenHookRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Token hook response with custom claims
          schema:
            $ref: '#/definitions/main.TokenHookResponse'
        "400":
          description: Bad request
          schema:
            type: string
        "403":
          description: Client expired
          schema:
            $ref: '#/definitions/main.TokenHookErrorResponse'
        "405":
          description: Method not allowed
          schema:
            type: string
      summary: Token hook for JWT claim injection
      tags:
      - hooks
swagger: "2.0"
