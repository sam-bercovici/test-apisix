{
    "swagger": "2.0",
    "info": {
        "description": "Sidecar service for Ory Hydra that provides token hook functionality, client creation with secret hashing, and bulk client sync.",
        "title": "Hydra Sidecar API",
        "contact": {
            "name": "API Support"
        },
        "license": {
            "name": "Apache 2.0",
            "url": "http://www.apache.org/licenses/LICENSE-2.0.html"
        },
        "version": "1.0"
    },
    "host": "localhost:8080",
    "basePath": "/",
    "paths": {
        "/admin/clients": {
            "post": {
                "description": "Proxies client creation to Hydra Admin API and returns the response enriched with client_secret_hash",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "clients"
                ],
                "summary": "Create OAuth2 client",
                "parameters": [
                    {
                        "description": "Client configuration",
                        "name": "client",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/main.HydraClientResponse"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Client created with secret hash",
                        "schema": {
                            "$ref": "#/definitions/main.EnhancedClientResponse"
                        }
                    },
                    "201": {
                        "description": "Client created with secret hash",
                        "schema": {
                            "$ref": "#/definitions/main.EnhancedClientResponse"
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "405": {
                        "description": "Method not allowed",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "502": {
                        "description": "Failed to create client in Hydra",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/admin/clients/rotate/{client_id}": {
            "post": {
                "description": "Rotates the client secret and returns the new secret along with its hash from the database. Optionally accepts client_secret_expires_at to set expiration for the new secret.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "clients"
                ],
                "summary": "Rotate client secret",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Client ID",
                        "name": "client_id",
                        "in": "path",
                        "required": true
                    },
                    {
                        "description": "Optional expiration settings",
                        "name": "request",
                        "in": "body",
                        "schema": {
                            "$ref": "#/definitions/main.RotateClientRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Client with new secret and hash",
                        "schema": {
                            "$ref": "#/definitions/main.EnhancedClientResponse"
                        }
                    },
                    "400": {
                        "description": "Bad request - missing client_id",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "404": {
                        "description": "Client not found",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "405": {
                        "description": "Method not allowed",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "502": {
                        "description": "Failed to rotate client secret in Hydra",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/admin/clients/{client_id}": {
            "get": {
                "description": "Retrieves a client from Hydra by client_id",
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "clients"
                ],
                "summary": "Get OAuth2 client",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Client ID",
                        "name": "client_id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Client details",
                        "schema": {
                            "$ref": "#/definitions/main.HydraClientResponse"
                        }
                    },
                    "400": {
                        "description": "Bad request - missing client_id",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "404": {
                        "description": "Client not found",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "502": {
                        "description": "Failed to get client from Hydra",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            },
            "delete": {
                "description": "Deletes a client from Hydra by client_id",
                "tags": [
                    "clients"
                ],
                "summary": "Delete OAuth2 client",
                "parameters": [
                    {
                        "type": "string",
                        "description": "Client ID to delete",
                        "name": "client_id",
                        "in": "path",
                        "required": true
                    }
                ],
                "responses": {
                    "204": {
                        "description": "Client deleted"
                    },
                    "400": {
                        "description": "Bad request - missing client_id",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "404": {
                        "description": "Client not found",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "502": {
                        "description": "Failed to delete client in Hydra",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/health": {
            "get": {
                "description": "Returns OK if the server is running (liveness probe)",
                "produces": [
                    "text/plain"
                ],
                "tags": [
                    "health"
                ],
                "summary": "Health check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/ready": {
            "get": {
                "description": "Returns OK if the database connection is healthy (readiness probe)",
                "produces": [
                    "text/plain"
                ],
                "tags": [
                    "health"
                ],
                "summary": "Readiness check",
                "responses": {
                    "200": {
                        "description": "OK",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "503": {
                        "description": "Database not ready",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/sync/clients": {
            "post": {
                "description": "Performs full reconciliation of clients - creates new, updates existing, deletes removed. Expects pre-hashed secrets.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "clients"
                ],
                "summary": "Bulk sync OAuth2 clients",
                "parameters": [
                    {
                        "description": "List of clients to sync",
                        "name": "clients",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/main.SyncClientsRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Sync completed",
                        "schema": {
                            "$ref": "#/definitions/main.SyncResult"
                        }
                    },
                    "400": {
                        "description": "Bad request - invalid JSON or hash format",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "405": {
                        "description": "Method not allowed",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "500": {
                        "description": "Internal error during sync",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        },
        "/token-hook": {
            "post": {
                "description": "Called by Hydra during token issuance to inject client metadata into JWT claims. Rejects expired clients.",
                "consumes": [
                    "application/json"
                ],
                "produces": [
                    "application/json"
                ],
                "tags": [
                    "hooks"
                ],
                "summary": "Token hook for JWT claim injection",
                "parameters": [
                    {
                        "description": "Token hook request from Hydra",
                        "name": "request",
                        "in": "body",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/main.TokenHookRequest"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "Token hook response with custom claims",
                        "schema": {
                            "$ref": "#/definitions/main.TokenHookResponse"
                        }
                    },
                    "400": {
                        "description": "Bad request",
                        "schema": {
                            "type": "string"
                        }
                    },
                    "403": {
                        "description": "Client expired",
                        "schema": {
                            "$ref": "#/definitions/main.TokenHookErrorResponse"
                        }
                    },
                    "405": {
                        "description": "Method not allowed",
                        "schema": {
                            "type": "string"
                        }
                    }
                }
            }
        }
    },
    "definitions": {
        "main.ClientResult": {
            "type": "object",
            "properties": {
                "client_id": {
                    "type": "string",
                    "example": "acme-service-1"
                },
                "error": {
                    "type": "string"
                },
                "status": {
                    "description": "\"created\", \"updated\", \"deleted\", \"failed\"",
                    "type": "string",
                    "example": "created"
                }
            }
        },
        "main.EnhancedClientResponse": {
            "type": "object",
            "properties": {
                "client_credentials_grant_access_token_lifespan": {
                    "description": "Access token lifespan for client_credentials grant",
                    "type": "string",
                    "example": "1h"
                },
                "client_id": {
                    "description": "OAuth2 client ID",
                    "type": "string",
                    "example": "acme-service-1"
                },
                "client_name": {
                    "description": "Human-readable client name",
                    "type": "string",
                    "example": "Acme Service 1"
                },
                "client_secret": {
                    "description": "Client secret (only returned on creation)",
                    "type": "string",
                    "example": "secret123"
                },
                "client_secret_expires_at": {
                    "description": "Unix timestamp when client secret expires (0 = never)",
                    "type": "integer",
                    "example": 1735689600
                },
                "client_secret_hash": {
                    "type": "string",
                    "example": "$pbkdf2-sha512$..."
                },
                "metadata": {
                    "description": "Client metadata",
                    "type": "object",
                    "additionalProperties": true
                }
            }
        },
        "main.HydraClientResponse": {
            "type": "object",
            "properties": {
                "client_credentials_grant_access_token_lifespan": {
                    "description": "Access token lifespan for client_credentials grant",
                    "type": "string",
                    "example": "1h"
                },
                "client_id": {
                    "description": "OAuth2 client ID",
                    "type": "string",
                    "example": "acme-service-1"
                },
                "client_name": {
                    "description": "Human-readable client name",
                    "type": "string",
                    "example": "Acme Service 1"
                },
                "client_secret": {
                    "description": "Client secret (only returned on creation)",
                    "type": "string",
                    "example": "secret123"
                },
                "client_secret_expires_at": {
                    "description": "Unix timestamp when client secret expires (0 = never)",
                    "type": "integer",
                    "example": 1735689600
                },
                "metadata": {
                    "description": "Client metadata",
                    "type": "object",
                    "additionalProperties": true
                }
            }
        },
        "main.RotateClientRequest": {
            "type": "object",
            "properties": {
                "client_secret_expires_at": {
                    "description": "Unix timestamp when the new client secret expires, 0 means never (optional)",
                    "type": "integer",
                    "example": 1735689600
                }
            }
        },
        "main.SyncClient": {
            "type": "object",
            "properties": {
                "audience": {
                    "description": "Allowed audiences (optional)",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "client_credentials_grant_access_token_lifespan": {
                    "description": "Access token lifespan for client_credentials grant, e.g. \"1h\", \"30m\" (optional)",
                    "type": "string",
                    "example": "1h"
                },
                "client_id": {
                    "description": "Client ID (required)",
                    "type": "string",
                    "example": "acme-service-1"
                },
                "client_name": {
                    "description": "Human-readable client name (optional)",
                    "type": "string",
                    "example": "Acme Service 1"
                },
                "client_secret": {
                    "description": "Pre-hashed client secret (required)",
                    "type": "string",
                    "example": "$pbkdf2-sha512$..."
                },
                "client_secret_expires_at": {
                    "description": "Unix timestamp when client secret expires, 0 means never (optional)",
                    "type": "integer",
                    "example": 1735689600
                },
                "grant_types": {
                    "description": "OAuth2 grant types (optional, defaults to [\"client_credentials\"])",
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "example": [
                        "client_credentials"
                    ]
                },
                "metadata": {
                    "description": "Client metadata for JWT claims (optional)",
                    "type": "object",
                    "additionalProperties": true
                },
                "redirect_uris": {
                    "description": "Redirect URIs (optional)",
                    "type": "array",
                    "items": {
                        "type": "string"
                    }
                },
                "response_types": {
                    "description": "OAuth2 response types (optional)",
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "example": [
                        "token"
                    ]
                },
                "scope": {
                    "description": "Space-separated list of scopes (optional)",
                    "type": "string",
                    "example": "read write"
                },
                "token_endpoint_auth_method": {
                    "description": "Token endpoint auth method (optional, defaults to \"client_secret_basic\")",
                    "type": "string",
                    "example": "client_secret_basic"
                }
            }
        },
        "main.SyncClientsRequest": {
            "type": "object",
            "properties": {
                "clients": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/main.SyncClient"
                    }
                }
            }
        },
        "main.SyncResult": {
            "type": "object",
            "properties": {
                "created_count": {
                    "type": "integer",
                    "example": 5
                },
                "deleted_count": {
                    "type": "integer",
                    "example": 1
                },
                "failed_count": {
                    "type": "integer",
                    "example": 0
                },
                "results": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/main.ClientResult"
                    }
                },
                "updated_count": {
                    "type": "integer",
                    "example": 3
                }
            }
        },
        "main.TokenHookErrorResponse": {
            "type": "object",
            "properties": {
                "error": {
                    "type": "string"
                },
                "error_description": {
                    "type": "string"
                }
            }
        },
        "main.TokenHookRequest": {
            "type": "object",
            "properties": {
                "request": {
                    "type": "object",
                    "properties": {
                        "client_id": {
                            "type": "string",
                            "example": "acme-service-1"
                        },
                        "granted_scopes": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "example": [
                                "read",
                                "write"
                            ]
                        }
                    }
                },
                "session": {
                    "type": "object",
                    "properties": {
                        "client_id": {
                            "type": "string",
                            "example": "acme-service-1"
                        }
                    }
                }
            }
        },
        "main.TokenHookResponse": {
            "type": "object",
            "properties": {
                "session": {
                    "type": "object",
                    "properties": {
                        "access_token": {
                            "type": "object",
                            "additionalProperties": true
                        }
                    }
                }
            }
        }
    }
}