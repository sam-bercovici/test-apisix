apiVersion: gateway.envoyproxy.io/v1alpha1
kind: BackendTrafficPolicy
metadata:
  name: tier2-daily-quota
  namespace: envoy-gateway-system
  annotations:
    description: "Tier 2 daily quota - tiered requests per day per org"
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: Gateway
    name: eg-gateway
    sectionName: internal  # Target only the internal listener
  rateLimit:
    type: Global
    global:
      rules:
      # Premium tier: 10,000/day per org
      - clientSelectors:
        - headers:
          - name: x-tier
            value: premium
          - type: Distinct
            name: x-enterprise-id
        limit:
          requests: 10000
          unit: Day
      # Basic tier: 1,000/day per org
      - clientSelectors:
        - headers:
          - name: x-tier
            value: basic
          - type: Distinct
            name: x-enterprise-id
        limit:
          requests: 1000
          unit: Day
      # Default (no tier): 500/day per org
      - clientSelectors:
        - headers:
          - type: Distinct
            name: x-enterprise-id
        limit:
          requests: 500
          unit: Day
